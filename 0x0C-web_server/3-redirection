#!/usr/bin/env bash
# This script configures Nginx on an Ubuntu machine
# to redirect /redirect_me to another page with a "301 Moved Permanently" status code.

set -euo pipefail

# Update package index
apt update

# Install Nginx
apt install -y nginx

# Start Nginx (if not already started)
service nginx start

# Ensure Nginx is listening on port 80
if ! grep -q "listen 80;" /etc/nginx/sites-available/default; then
    sed -i '/listen 80;/c\        listen 80;' /etc/nginx/sites-available/default
fi

# Restart Nginx to apply changes
service nginx restart

# Create a temporary HTML file with the redirection content
echo "<html><head><meta http-equiv=\"refresh\" content=\"0; url=http://example.com/new_page\"></head><body></body></html>" > /var/www/html/redirect_me.html

# Configure Nginx to redirect /redirect_me with a 301 Moved Permanently status code
sed -i "/location \/ {/a \\tlocation \/redirect_me {\\n\t\treturn 301 http:\/\/\$host\/new_page;\\n\t}" /etc/nginx/sites-available/default

# Restart Nginx to apply changes
service nginx restart

# Display message indicating successful configuration
echo "Nginx has been configured to redirect /redirect_me to another page with a 301 Moved Permanently status code."

