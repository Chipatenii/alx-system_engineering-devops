#!/usr/bin/env bash
# This script configures Nginx on an Ubuntu machine
# to have a custom 404 page that contains the string "Ceci n'est pas une page".

set -euo pipefail

# Update package index
apt update

# Install Nginx
apt install -y nginx

# Start Nginx (if not already started)
service nginx start

# Ensure Nginx is listening on port 80
if ! grep -q "listen 80;" /etc/nginx/sites-available/default; then
    sed -i '/listen 80;/c\        listen 80;' /etc/nginx/sites-available/default
fi

# Restart Nginx to apply changes
service nginx restart

# Create a custom 404 page with the required string
echo "Ceci n'est pas une page" > /usr/share/nginx/html/404.html

# Configure Nginx to use the custom 404 page
sed -i '/server_name _;/a \\n    error_page 404 /404.html;\n    location = /404.html {\n        root /usr/share/nginx/html;\n        internal;\n    }' /etc/nginx/sites-available/default

# Restart Nginx to apply changes
service nginx restart

# Display message indicating successful configuration
echo "Nginx has been configured to have a custom 404 page that contains the string 'Ceci n'est pas une page'."

